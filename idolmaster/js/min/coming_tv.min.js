"use strict";function _possibleConstructorReturn(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(i,e,a){return e&&t(i.prototype,e),a&&t(i,a),i}}();!function(t){function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}var e={};i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=1)}([function(t,i,e){e.d(i,"a",function(){return a});var a=function(){function t(i){_classCallCheck(this,t);var e=i.position,a=i.parent,n=i.lib,s=void 0===n?"lib":n,o=i.img,h=void 0===o?"images":o,r=i.index,c=void 0===r?0:r;this.shortpants=!1,this.callaction=null,this.cjs=null,this.lib=s,this.img=h,this.index=c,this.shadow_flg=!1,this.images_backup={},this.pose_id=1,this.getParent=function(){return a},this.getPosition=function(){return parseInt(e)}}return _createClass(t,[{key:"isShortpants",value:function(t){var i=!1,e=this.getParent().cloth_data[t];if(e)for(var a in e)"replace_leg_L_front"==a&&(i=!0);this.shortpants=i}},{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var i in this.image_url_list)i.indexOf("costume")>-1&&this.isShortpants(i);var e={};for(var a in this.image_url_list)for(var n in this.getParent().cloth_data[a]){if(a.indexOf("costume")>-1){if((2==this.breast_size||3==this.breast_size)&&"replace_breast_L"==n)continue;if((1==this.breast_size||3==this.breast_size)&&"replace_breast_S"==n)continue}if(a.indexOf("leg")>-1)if(this.shortpants){if("replace_item_foot_L_back"==n)continue}else if("replace_item_foot_L_front"==n)continue;e[n]=this.getParent().cloth_data[a][n]}var s=this.getParent().cloth_data["cheek"+(4==this.body_type?1:this.body_type)];for(var o in s)e[o]=s[o];this.runCjs(e,t,this.img,this.index)}},{key:"getVariables",value:function(){return{small_character_flg:2==this.body_type?1:0,big_character_flg:4==this.body_type?1:0,chara_num:this.getParent().getCharacterLength(),chara_order:this.getPosition(),shadow_flg:this.shadow_flg,pose_id:this.pose_id}}},{key:"changeOption",value:function(t){t||(t=this.getVariables()),this.cjs[this.swf].init(t)}},{key:"doAction",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.cjs[this.swf].motion_set(t)}},{key:"runCjs",value:function(t,i,e,a){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=this.getParent();s.clearImages(),$.extend(window[e],t),$.extend(this.images_backup,t);var o=window[this.lib][this.swf];this.cjs=new o,this.cjs.visible=n,s.stage.addChildAt(this.cjs,a),s.stage.update(),this.changeOption(),i&&i.resolve()}},{key:"cloneTo",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.getParent().clearImages(),$.extend(window[this.img],this.images_backup);var e=window[this.lib][this.swf],a=new e,n=this.getVariables();return null==i?t.addChild(a):t.addChildAt(a,i),t.update(),a[this.swf].init(n),a}}]),t}()},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});var a=e(2),n=function(){function t(i){var e=this;_classCallCheck(this,t);var n=this;for(var s in i)this[s]=i[s];var o=window.petitManager||new a["a"],h=window.canvasManager||new Commonjs.Canvas;window.petitManager=o,window.canvasManager=h,this.storyContainer=".story-container",this.commentContainer=".comment-container",this.$commentDisplay=$(this.commentContainer+" > span"),this.commentDisplayName="comment",this.btnNextLine=".showNextLine",this.btnNextLineName="showNextLine",this.$btnShowNextLine=$(".showNextLine"),this.btnNextScene=".btn-nextscene",this.btnNextsceneName="btn-nextscene",this.showArrowName="showArrow",this.cjsContainer=".cjs-container",this.bgContainer=".bg-container",this.curtainContainer=".curtain-container",this.eyecatch="#jsEyeCatch",this.isMonitorModeName="isMonitorMode",this.isFinishedName="isFinished",this.scene=0,this.speed=60,this.delay=300,this.line=0,this.guest_num=Object.keys(this.data.idol_avatar).length,this.mode=1,this.stageItems={},this.monitorItems={},this.charaManager={},this.audienceManager,this.pinyaManager,this.balloonManager,this.nameplateManager,this.audienceParam={chara_num:this.guest_num,mode:this.mode},this.pinyaParam={chara_num:this.guest_num,mode:this.mode,motion_finish_callback:function(){window.comingTv.pinya_motion_finished=!0,window.comingTv.readyNextScene()}},this.balloonParam={chara_num:this.guest_num,mode:this.mode,speak_type:1,position1_talk:0,position2_talk:0,position3_talk:0,position4_talk:0,position5_talk:0,position0_talk:0,position9_talk:0,motion_finish_callback:function(){window.comingTv.balloon_motion_finished=!0,window.comingTv.playComment()}},this.nameplateParam={chara_num:this.guest_num,mode:this.mode,position1_talk:0,position2_talk:0,position3_talk:0,position4_talk:0,position5_talk:0,position0_talk:0,position9_talk:0,position1_charaid:0,position2_charaid:0,position3_charaid:0},this.namePlateHideParam={position0_hide:0,position1_hide:1,position2_hide:1,position3_hide:1,position4_hide:1,position5_hide:1,position9_hide:1},this.stayMotions={stay:1,stay_sit:1,out:1},this.guest_motion_counter=0,this.mc_motion_finished=!1,this.guest_motion_finished=!1,this.pinya_motion_finished=!1,this.comment_finished=!1,this.autoNext=!1,this.isGuestsStaged=!1,this.guestStagedScene=0,this.isPinyaItemRemoved=null,this.isSat={mc:!1,1:!1,2:!1,3:!1,4:!1,5:!1},this.hasPosChangedChara=!1,this.hasVideo=!1,this.isPlayedVideo=!1;for(var r in this.data.idol_avatar)this.data.idol_avatar[r].swf="cjs001_petit_test";for(var c in this.data.video_idol_avatar)this.data.video_idol_avatar[c].swf="cjs001_petit_test";this.mc.swf="cjs002_petit_nana",o.requireCJS(this.cjs_file).done(function(){var t=n.data.idol_avatar;t["mc"]=n.mc,$.each(n.data.video_idol_avatar,function(i,e){t["video_"+i]=e,o.setAnotherCharacter("video_"+i)}),o.setAnotherCharacter("mc"),o.setCharacters(t),e.charaManager=o.getAllChracter();var i=void 0,a=void 0,s=void 0,r=void 0;h.init(o.canvas,e.manifest.balloon,lib,null,18,function(){i=h.addChild("cjs005_balloon")},!1,o.stage),h.init(o.canvas,e.manifest.nameplate,lib,null,18,function(){a=h.addChild("cjs006_nameplate")},!1,o.stage),h.init(o.canvas,e.manifest.pinya,lib,null,18,function(){s=h.addChild("cjs004_pinya")},!1,o.stage),h.init(o.canvas,e.manifest.audience,lib,null,18,function(){r=h.addChild("cjs003_audience")},!1,o.stage),e.balloonCjs=i,e.nameplateCjs=a,e.pinyaCjs=s,e.audienceCjs=r,e.balloonManager=i.cjs005_balloon,e.audienceManager=r.cjs003_audience,e.pinyaManager=s.cjs004_pinya,e.nameplateManager=a.cjs006_nameplate;var c=e.manifest["interior"][e.guest_num];for(var l in c){var d=new Image;d.src=c[l],d.width=320,d.height=420,e.stageItems[l]=new createjs.Bitmap(d)}var m=e.monitor_item_list||[];m["frame"]=e.bg_list[99];for(var u in m){var _=new Image;_.src=m[u],_.width=320,_.height=210,e.monitorItems[u]=new createjs.Bitmap(_)}}),o.loaded_action=function(){e.initCanvas(),$(e.eyecatch).hide(),e.initReady()}}return _createClass(t,[{key:"initReady",value:function(){this.setBg(),this.audienceManager.init(this.audienceParam),this.pinyaManager.init(this.pinyaParam),this.balloonManager.init(this.balloonParam),this.nameplateManager.init(this.nameplateParam),this.nameplateManager.hide_manage(this.namePlateHideParam),this.setCharaAllMotion(),this.initCommenter(),0==this.getGuestCallbackMotionNum()&&(this.guest_motion_counter=0,this.guest_motion_finished=!0);var t=this.detail[this.scene];t.message?this.setComment():(this.comment_finished=!0,this.readyNextScene()),t.audience&&setTimeout(function(){window.comingTv.audienceManager.run_effect()},this.delay),t.pinya_id||(this.pinya_motion_finished=!0,this.readyNextScene())}},{key:"initCommenter",value:function(){var t=this;this.commenter=$(this.storyContainer).comment_timer({click:this.btnNextLineName,speed:this.speed,call:function(){t.commentCallback()}})}},{key:"initCanvas",value:function(){var t=window.canvasManager;if(1==this.mode&&1==this.guest_num&&t.stage.addChild(this.charaManager[1].cjs),1==this.mode&&2==this.guest_num&&(t.stage.addChild(this.charaManager[2].cjs),t.stage.addChild(this.charaManager[1].cjs)),1==this.mode&&3==this.guest_num&&(t.stage.addChild(this.charaManager[3].cjs),t.stage.addChild(this.stageItems["sofa_guests"]),t.stage.addChild(this.charaManager[2].cjs),t.stage.addChild(this.charaManager[1].cjs)),1==this.mode&&4==this.guest_num&&(t.stage.addChild(this.charaManager[4].cjs),t.stage.addChild(this.charaManager[3].cjs),t.stage.addChild(this.stageItems["sofa_guests"]),t.stage.addChild(this.charaManager[2].cjs),t.stage.addChild(this.charaManager[1].cjs)),1==this.mode&&5==this.guest_num&&(t.stage.addChild(this.charaManager[5].cjs),t.stage.addChild(this.charaManager[4].cjs),t.stage.addChild(this.stageItems["sofa_guests"]),t.stage.addChild(this.charaManager[3].cjs),t.stage.addChild(this.charaManager[2].cjs),t.stage.addChild(this.charaManager[1].cjs)),t.stage.addChild(this.stageItems["sofa_mc"]),t.stage.addChild(this.charaManager["mc"].cjs),t.stage.addChild(this.stageItems["table"]),t.stage.addChild(this.nameplateCjs),this.data.video_flag){for(var i in this.monitorItems)"frame"!=i&&(t.stage.addChild(this.monitorItems[i]),this.monitorItems[i].visible=!1);if(2==this.mode){for(var e=1;e<4;e++)void 0!=this.charaManager["video_"+e]&&(t.stage.addChild(this.charaManager["video_"+e].cjs),this.charaManager["video_"+e].cjs.visible=!0,this.charaManager["video_"+e].changeMotion("stay"));t.stage.addChild(this.monitorItems["frame"]),this.monitorItems["frame"].visible=!0}}else for(var a in this.monitorItems)t.stage.addChild(this.monitorItems[a]),this.monitorItems[a].visible=!1;t.stage.addChild(this.balloonCjs),t.stage.addChild(this.pinyaCjs),t.stage.addChild(this.audienceCjs)}},{key:"setBg",value:function(t){$(this.bgContainer).empty();var i=new Image;i.width=320,i.height=420,$(this.bgContainer).append(i);var e=t||this.detail[this.scene];i.src=this.bg_list[e.bg_image]}},{key:"setCurtain",value:function(t){"close"==t?$(this.curtainContainer).css("display","block"):"open"==t&&$(this.curtainContainer).fadeOut(this.delay,function(){window.comingTv.readyNextScene()})}},{key:"isModeChanged",value:function(){var t=this.detail[this.scene-1],i=this.detail[this.scene];return i.bg_image-t.bg_image==-this.guest_num?(this.updateMode(2),!0):i.bg_image-t.bg_image==this.guest_num&&(this.updateMode(1),!0)}},{key:"updateMode",value:function(t){this.mode=t,this.audienceParam.mode=t,this.pinyaParam.mode=t,this.balloonParam.mode=t,this.nameplateParam.mode=t,window.petitManager.setMode(t)}},{key:"setModeChangedView",value:function(){if(this.initCanvas(),this.setCurtain("close"),this.setBg(),this.setNameplateHideOptions(this.scene+1),this.setNameplatePosition(this.scene+1),this.nameplateManager.init(this.nameplateParam),this.nameplateManager.hide_manage(this.namePlateHideParam),this.audienceManager.init(this.audienceParam),this.balloonManager.init(this.balloonParam),2==this.mode){for(var t in this.stageItems)this.stageItems[t].visible=!1;this.monitorItems["frame"].visible=!0,this.monitorItems[this.scene]&&(this.monitorItems[this.scene].visible=!0),this.setCharaAllMotion(this.scene+1,"stay"),this.pinyaManager.visible&&!this.isPinyaItemRemoved&&(this.pinyaManager.visible=!1),$(this.commentContainer).addClass(this.isMonitorModeName),this.balloonParam["position1_talk"]=0,this.balloonParam["position2_talk"]=0,this.balloonParam["position3_talk"]=0,this.balloonParam["position4_talk"]=0,this.balloonParam["position5_talk"]=0}else{this.hasPosChangedChara=!1;for(var i in this.stageItems)this.stageItems[i].visible=!0;for(var e in this.monitorItems)this.monitorItems[e].visible=!1;this.setCharaAllMotion(this.scene),$(this.commentContainer).removeClass(this.isMonitorModeName),this.pinyaManager.visible||!1!==this.isPinyaItemRemoved||(this.pinyaManager.visible=!0)}setTimeout(function(){window.comingTv.comment_finished=!0,window.comingTv.mc_motion_finished=!0,window.comingTv.guest_motion_finished=!0,window.comingTv.pinya_motion_finished=!0,window.comingTv.setCurtain("open")},this.delay)}},{key:"checkCharaMonitor",value:function(){}},{key:"checkCharaPosChanged",value:function(){var t=this.detail[this.scene-1],i=this.detail[this.scene];if(2==this.mode)for(var e in this.data.idol_avatar)""!=t["position_"+e]&&i["position_"+e]!=t["position_"+e]&&(this.hasPosChangedChara=!0)}},{key:"checkCharaSat",value:function(t){var i=this.detail[this.scene]["motion_"+t];this.isSat[t]=-1!=i.indexOf("sit")}},{key:"setCharaMotions",value:function(t){var i=this,e=this.detail[this.scene];this.detail[this.scene-1];0==this.getGuestCallbackMotionNum()&&(this.guest_motion_counter=0,this.guest_motion_finished=!0),""==e["motion_mc"]&&(this.mc_motion_finished=!0);for(var a in this.data.idol_avatar)!function(a){var n="stay",s=0;2==i.mode&&(i.charaManager[a].changePosition(-1,n),e["position_"+a]&&i.charaManager[a].changePosition(parseInt(e["position_"+a]),n)),""!=e["motion_"+a]?(i.checkCharaSat(a),"mc"!=a&&(i.charaManager[a].cjs.visible=!0),n=e["motion_"+a],s=i.hasPosChangedChara?i.delay:s,setTimeout(function(){window.comingTv.charaManager[a].changeMotion(n)},s)):"stay"==t&&(n=i.isSat[a]?"stay_sit":"stay",i.charaManager[a].changeMotion(n))}(a)}},{key:"setCharaAllMotion",value:function(t,i){var e=t||this.scene,a="";for(var n in this.data.idol_avatar)a=i||this.detail[e]["motion_"+n],this.checkCharaSat(n),this.charaManager[n].changeMotion(a),2==this.mode&&this.charaManager[n].changePosition(parseInt(this.detail[e]["position_"+n]),a)}},{key:"setCharaCostumes",value:function(t){var i=this,e=this.detail[this.scene],a=window.canvasManager,n=window.petitManager,s=0!=t?this.changed_costumes[e.change_avatar_group_id]:this.original_costumes;for(var o in this.data.idol_avatar)s[o]&&(this.data.idol_avatar[o].image_url_list=s[o]);var h=this.data.idol_avatar;n.setAnotherCharacter("mc"),n.setCharacters(h),this.charaManager=n.getAllChracter(),n.loaded_action=function(){for(var t in h)i.charaManager[t].cjs.visible=!0,a.stage.removeChildAt(i.charaManager[t].cjs,0),a.stage.removeChildAt(i.charaManager["mc"].cjs,0);i.initCanvas(),i.setCharaMotions("stay")}}},{key:"setNameplatePosition",value:function(t){for(var i=t||this.scene,e=this.detail[i],a=1;a<this.guest_num+1;a++)e["position_"+a]&&(this.nameplateParam["position"+e["position_"+a]+"_charaid"]=a)}},{key:"setNameplateHideOptions",value:function(t){var i=t||this.scene,e=this.detail[i];if(this.namePlateHideParam["position1_hide"]=1,this.namePlateHideParam["position2_hide"]=1,this.namePlateHideParam["position3_hide"]=1,this.namePlateHideParam["position4_hide"]=1,this.namePlateHideParam["position5_hide"]=1,this.namePlateHideParam["position0_hide"]=0,this.namePlateHideParam["position9_hide"]=1,2==this.mode)for(var a=1;a<this.guest_num+1;a++)e["position_"+a]&&(this.namePlateHideParam["position"+e["position_"+a]+"_hide"]=0);else for(var n in this.data.idol_avatar)this.namePlateHideParam["position"+n+"_hide"]=0}},{key:"pinyaCallback",value:function(t){var i=this.detail[this.scene];this.manifest["pinya"][1]["src"]=this.pinya_item_list[i.pinya_id];var e=window.canvasManager,a=window.petitManager,n=void 0;e.init(a.canvas,this.manifest.pinya,lib,null,18,function(){n=e.addChild("cjs004_pinya")},!1,a.stage),e.stage.addChild(this.audienceCjs),a.stage.update(),this.pinyaCjs=n,this.pinyaManager=n.cjs004_pinya,this.pinyaManager.init(this.pinyaParam),this.pinyaManager.run_motion(t)}},{key:"commentCallback",value:function(){this.line++,this.comment_list[this.line]?(this.$commentDisplay.removeClass(this.commentDisplayName).eq(this.line).addClass(this.commentDisplayName).data("comment",this.comment_list[this.line]),this.$btnShowNextLine.trigger("click")):(this.comment_finished=!0,this.readyNextScene())}},{key:"setCommentList",value:function(t){return!!t&&(this.comment_list=t,!0)}},{key:"setComment",value:function(){var t=this.detail[this.scene];if(this.balloonParam["position1_talk"]=0,this.balloonParam["position2_talk"]=0,this.balloonParam["position3_talk"]=0,this.balloonParam["position4_talk"]=0,this.balloonParam["position5_talk"]=0,this.balloonParam["position6_talk"]=0,this.balloonParam["position7_talk"]=0,this.balloonParam["position8_talk"]=0,this.nameplateParam["position1_talk"]=0,this.nameplateParam["position2_talk"]=0,this.nameplateParam["position3_talk"]=0,this.nameplateParam["position4_talk"]=0,this.nameplateParam["position5_talk"]=0,this.balloonParam["position0_talk"]=parseInt(t["message_arrow_mc"])||0,this.nameplateParam["position0_talk"]=parseInt(t["message_arrow_mc"])||0,1==this.mode)for(var i in this.data.idol_avatar)"mc"!=i&&(this.balloonParam["position"+i+"_talk"]=parseInt(t["message_arrow_"+i])||0,this.nameplateParam["position"+i+"_talk"]=parseInt(t["message_arrow_"+i])||0);else{for(var e=1;e<6;e++)if(t["message_arrow_"+e]){var a=("message_arrow_"+e).substr(-1,1),n=t["position_"+a];this.balloonParam["position"+n+"_talk"]=1,this.nameplateParam["position"+n+"_talk"]=1}for(var s=6;s<9;s++)t["message_arrow_video_"+(s-5)]&&(this.balloonParam["position"+s+"_talk"]=1)}this.balloonParam["speak_type"]=parseInt(t.message_window_type)||1,this.balloonManager.init(this.balloonParam),this.balloonManager.run_talk(this.balloonParam),this.setCommentList(t.message.split(/\n/)),2==this.mode&&this.setNameplatePosition(),this.nameplateManager.run_talk(this.nameplateParam)}},{key:"playComment",value:function(){this.$commentDisplay=$(this.commentContainer+" > span"),this.$commentDisplay.eq(this.line).addClass(this.commentDisplayName).data("comment",this.comment_list[this.line]),this.$btnShowNextLine||(this.$btnShowNextLine=$(this.btnNextLine)),this.line!=this.comment_list.length&&this.$btnShowNextLine.trigger("click")}},{key:"setAllComment",value:function(){if(this.balloon_motion_finished){this.$commentDisplay.data("comment","").removeClass(this.commentDisplayName);var t=window.comment_timer_arr;if(t){for(var i in t)clearInterval(t[i]);for(var i in this.$commentDisplay)this.$commentDisplay.eq(i).text(this.comment_list[i]);this.line=this.comment_list.length,setTimeout(function(){window.comingTv.comment_finished=!0,window.comingTv.readyNextScene()},this.delay)}this.balloon_motion_finished=!1}else $(this.btnNextScene).attr("id","showAll")}},{key:"getGuestCallbackMotionNum",value:function(){var t=0;for(var i in this.data.idol_avatar)"mc"!=i&&void 0==this.detail[this.scene]["motion_"+i]&&(this.detail[this.scene]["motion_"+i]in this.stayMotions||t++);return t}},{key:"checkGuestMotionFinished",value:function(){++this.guest_motion_counter==this.getGuestCallbackMotionNum()&&(this.guest_motion_counter=0,this.guest_motion_finished=!0)}},{key:"guest_motion_finish_callback",value:function(){this.isGuestsStaged||(this.guestStagedScene=this.scene),this.isGuestsStaged=!0,this.checkGuestMotionFinished(),this.readyNextScene()}},{key:"mc_motion_finish_callback",value:function(){this.mc_motion_finished=!0,this.readyNextScene()}},{key:"readyNextScene",value:function(){if(this.guest_motion_finished&&this.mc_motion_finished&&this.comment_finished&&this.pinya_motion_finished){if(this.isGuestsStaged&&this.guestStagedScene==this.scene){for(var t in this.data.idol_avatar)this.namePlateHideParam["position"+t+"_hide"]=0;this.nameplateManager.hide_manage(this.namePlateHideParam)}if(this.detail[this.scene].auto_next)return this.mc_motion_finished=!1,this.guest_motion_finished=!1,this.comment_finished=!1,this.pinya_motion_finished=!1,this.autoNext=!0,setTimeout(function(){window.comingTv.changeNext(),window.comingTv.autoNext=!1},this.delay),!1;if($(this.btnNextScene).attr("id","next").addClass(this.showArrowName),this.mc_motion_finished=!1,this.guest_motion_finished=!1,this.comment_finished=!1,this.pinya_motion_finished=!1,void 0==this.detail[this.scene+1]){$("<a />").attr({href:this.return_url,class:this.isFinishedName}).appendTo(this.cjsContainer)}}}},{key:"changeNext",value:function(){if(void 0==this.detail[this.scene])return!1;$(this.btnNextScene).removeClass(this.showArrowName),this.autoNext||this.$commentDisplay.text("").removeClass(this.commentDisplayName),window.bb_loader.stop(this.scene),this.hasPosChangedChara=!1,this.scene++,this.line=0;var t=this.detail[this.scene];if(this.isModeChanged())return this.setModeChangedView(),!1;if(this.checkCharaPosChanged(),""==t.change_avatar_group_id?this.setCharaMotions():this.setCharaCostumes(t.change_avatar_group_id),t.message){$(this.btnNextScene).attr("id","showAll");var i=0;this.hasPosChangedChara&&(i=this.delay,this.balloonManager.visible=!1),setTimeout(function(){window.comingTv.setComment()},i)}else this.comment_finished=!0,this.autoNext||(this.balloonManager.visible=!1);if(t.voice_url&&$("#voice"+this.scene).trigger("click"),t.audience&&setTimeout(function(){window.comingTv.audienceManager.run_effect()},this.delay),t.monitor&&(this.monitorItems[this.scene].visible=!0),t.pinya_id){var e=t.pinya_id>0?1:0;e?this.pinyaCallback(e):(this.pinyaManager.run_motion(e),this.isPinyaItemRemoved=!0,this.pinya_motion_finished=!0)}else this.pinya_motion_finished=!0}}]),t}();window.ComingTv=n},function(t,i,e){e.d(i,"a",function(){return o});var a=e(3),n=e(4),s=e(5),o=function(t){function i(){var t;_classCallCheck(this,i);var e={},a=(t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e)),1),n=[];return t.setMode=function(i){a=i,t.changeOption()},t.getMode=function(){return parseInt(a)},t.setAnotherCharacter=function(t){$.inArray(t,n)>-1||n.push(t)},t.getAnotherLength=function(){return n.length},t}return _inherits(i,t),_createClass(i,[{key:"init",value:function(t){if(this.deleteQue.length){for(var i in this.deleteQue)this.deleteCharacter(this.deleteQue[i]);this.deleteQue.splice(0,this.deleteQue.length)}for(var e in t)if(void 0==t[e].cjs){var a=null,o=e;if(e.match(/video/)){var h={video_1:6,video_2:7,video_3:8};o=h[e]}switch(o){case"mc":a=new s["a"]({position:e,parent:this,lib:"lib2",img:"images",index:0});break;default:a=new n["a"]({position:o,parent:this,index:0})}t[e]=$.extend(a,t[e])}this.initReady(t)}},{key:"ready",value:function(t){var i=this,e=[];Object.keys(t).forEach(function(i){var a=$.Deferred();t[i].init(a),e.push(a.promise())}),$.when.apply($,e).then(function(){"function"==typeof i.loaded_action&&(window.characters=t,i.loaded_action())})}}]),i}(a["a"])},function(t,i,e){e.d(i,"a",function(){return n});var a=e(0),n=function(){function t(i){var e=this;_classCallCheck(this,t);var a=i||{};this.cloth_data={},this.el="#animation-container",this.$el=null,this.prefetch=null,this.loaded_action=null,this.deleteQue=[],this.headDOM=document.getElementsByTagName("head")[0],this.fps=18,this.stage=null,this.images={},this.canvas_width=640,this.canvas_height=840,this.canvas_id="",this.getCharacterLength=function(){return e.getCharactersKeys().length},this.getCharactersKeys=function(){return Object.keys(a)},this.setCharacters=function(t,i){if("object"!=typeof t)return!1;for(var n in t){var s=$.extend({},t[n]);a[n]=s}return!!i||(e.initCharacters(),!0)},this.initCharacters=function(){e.init(a)},this.deleteCharacter=function(t){return void 0!=a[t]&&(void 0!=a[t].api&&a[t].delPex(),delete a[t],!0)},this.changeOption=function(){for(var t in a)a[t].changeOption()},this.getChracter=function(t){return void 0===t?a:a[t]},this.getAllChracter=function(){return a}}return _createClass(t,[{key:"requireCJS",value:function(t){var i=this;window.images=this.images;var e=$.Deferred();return requirejs(["easeljs_0_7_1","tweenjs"],function(){requirejs(["movieclipjs"],function(){requirejs(t,function(){i.elementsInitialize(),i.stage=new createjs.Stage(i.canvas),createjs.Ticker.setFPS(i.fps),createjs.Ticker.addEventListener("tick",function(){i.stage.update()}),e.resolve()})})}),e.promise()}},{key:"clearImages",value:function(){for(var t in this.images)delete this.images[t]}},{key:"init",value:function(t){if(this.deleteQue.length){for(var i in this.deleteQue)this.deleteCharacter(this.deleteQue[i]);this.deleteQue.splice(0,this.deleteQue.length)}for(var e in t)if(void 0==t[e].cjs){var n=new a["a"]({position:e,parent:this,lib:"lib",img:"images"});t[e]=$.extend(n,t[e])}this.initReady(t)}},{key:"cjsStop",value:function(){createjs.Ticker.setPaused(!0),createjs.Ticker.reset()}},{key:"elementsInitialize",value:function(){this.$el||(this.$el=$(this.el),this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas_width,this.canvas.height=this.canvas_height,this.canvas.id=this.canvas_id,this.$el.append(this.canvas))}},{key:"setPrefetch",value:function(){if(!this.prefetch){var t=document.getElementById("prefetch");t||(t=document.createElement("div"),t.id="prefetch",this.headDOM.appendChild(t)),this.prefetch=t}}},{key:"initReady",value:function(t){this.clothMerge(t)}},{key:"clothMerge",value:function(t){var i={};for(var e in t)$.extend(i,t[e].image_url_list);for(var a=1;a<=3;a++)i["cheek"+a]="";this.loadClothData(i,t)}},{key:"loadClothData",value:function(t,i){var e=this,a=[];for(var n in t){var s=$.Deferred();a.push(s.promise()),void 0===this.cloth_data[n]?void 0!==window[n]?this.imageAlready(n,window[n],s):this.loadImageJs(t[n],n,s):s.resolve()}$.when.apply($,a).then(function(){$(e.prefetch).empty(),e.ready(i)})}},{key:"loadImageJs",value:function(t,i,e){var a=this,n=document.createElement("script");n.onload=function(){a.imageAlready(i,window[i],e)},n.src=t,this.headDOM.appendChild(n)}},{key:"imageAlready",value:function(t,i,e){var a=[];for(var n in i){var s=$.Deferred();a.push(s),this.cloth_data[t]=[],this.imageToReplace(t,i[n],n,s)}$.when.apply($,a).then(function(){e.resolve()})}},{key:"imageToReplace",value:function(t,i,e,a){var n=this,s=new Image;s.onload=function(){n.cloth_data[t][e]=s,a.resolve()},s.src=i,this.setPrefetch(),this.prefetch.appendChild(s)}},{key:"ready",value:function(t){var i=this,e=[];for(var a in t){var n=$.Deferred();t[a].init(n),e.push(n.promise())}$.when.apply($,e).then(function(){"function"==typeof i.loaded_action&&i.loaded_action()})}}]),t}()},function(t,i,e){e.d(i,"a",function(){return n});var a=e(0),n=function(t){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t)),a="stay_sit";return e.changeMotion=function(t){a=t,e.doAction(a)},e.getMotion=function(){return a},e.changePosition=function(t,i){var a=e.getVariables();a.chara_order=t,a.motion_act=i,e.changeOption(a)},e}return _inherits(i,t),_createClass(i,[{key:"runCjs",value:function(t,i,e,a){var n=(!(arguments.length>4&&void 0!==arguments[4])||arguments[4],this.getParent());n.clearImages(),$.extend(window[e],t),$.extend(this.images_backup,t);var s=window[this.lib][this.swf];this.cjs=new s,n.stage.addChildAt(this.cjs,a),n.stage.update(),this.changeOption(),i&&i.resolve(),this.cjs.visible=!1}},{key:"getVariables",value:function(){var t=this.getParent();return{small_character_flg:2==this.body_type?1:0,big_character_flg:4==this.body_type?1:0,chara_num:t.getCharacterLength()-t.getAnotherLength(),chara_order:this.getPosition(),motion_act:this.getMotion(),mode:t.getMode(),motion_finish_callback:function(t,i){window.comingTv.guest_motion_finish_callback()}}}}]),i}(a["a"])},function(t,i,e){e.d(i,"a",function(){return n});var a=e(0),n=function(t){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t)),a="stay_sit";return e.changeMotion=function(t){a=t,e.doAction(a)},e.getMotion=function(){return a},e.changePosition=function(t,i){},e}return _inherits(i,t),_createClass(i,[{key:"runCjs",value:function(t,i,e,a){var n=(!(arguments.length>4&&void 0!==arguments[4])||arguments[4],this.getParent());n.clearImages(),$.extend(window[e],t),$.extend(this.images_backup,t);var s=window[this.lib][this.swf];this.cjs=new s,n.stage.addChildAt(this.cjs,a),n.stage.update(),this.changeOption(),i&&i.resolve()}},{key:"getVariables",value:function(){var t=this.getParent();return{chara_num:t.getCharacterLength()-t.getAnotherLength(),motion_act:this.getMotion(),mode:t.getMode(),motion_finish_callback:function(t){window.comingTv.mc_motion_finish_callback()}}}}]),i}(a["a"])}]);