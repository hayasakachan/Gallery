"use strict";$(function(){function e(){var e=m.detail_list[c].data.hash_card_id;$("#search_cartoon").attr("href",p.replace("__idol_search_param__",m.detail_list[c].idol_search_param)),$(".form_check_idol_comment_3rd").find("input[name=select_card_hash]").val(e),m.detail_list[c].is_exist_archive?($(".js_submit_check_idol_comment_5th").parent().show(),$(".form_check_idol_comment_5th").find("input[name=card_hash]").val(e),$(".form_check_idol_comment_5th").find("input[name=redirect_url]").val(h.replace(/__hash_card_id__/g,e))):$(".js_submit_check_idol_comment_5th").parent().hide()}function t(e){var e,t;e="l_premium"==m.detail_list[c].show_card_type?+m.detail_list[c].archive.premium?m.images.l_premium[c]:m.images.l[c]:+m.detail_list[c].archive.normal?m.images.l[c]:+m.detail_list[c].archive.premium?m.images.l_premium[c]:"",t="l_premium"==m.detail_list[c].show_card_type?m.images.l_nosign_p[c]:+m.detail_list[c].archive.normal?m.images.l_nosign[c]:+m.detail_list[c].archive.premium?m.images.l_nosign_p[c]:"",F.set({idol_detail:m.detail_list[c],idol_image_bg_attribute:m.images.bg,idol_image:e,idol_image_quest:m.images.quest[c],idol_image_nosign:t,idol_image_noframe:m.images.l_noframe[c],idol_image_mask_l:m.images.mask_l[c],idol_image_mask_l_p:m.images.mask_l_p[c],birthday_flag:d}),I.render()}function i(){L.set(m.detail_list[c]),N.render()}function a(){m.detail_list[c].filtered_comments=l(m.detail_list[c].comments),m.detail_list[c].voice_enable=te.check.isVoicePlay(),D.set(m.detail_list[c]),H.render()}function n(){var e=m.detail_list[c];if(e.voice_enable){var t=e.data.attribute.slice(0,2),i=e.data.hash_card_id;$(".btn_idol_voice").each(function(a,n){var r=$(n).data("voice-key"),_=e.voice[r];_&&(f[r+"_"+i]=_,g[r+"_"+i]=u(""),g[r+"_"+i].first=0,g[r+"_"+i].addEventListener("play",function(){o(n,t)}),g[r+"_"+i].addEventListener("pause",function(){s(n,t)}))})}}function o(e,t){$(e).removeClass("btn_idol_voice attribute_"+t+"_voice_mark_02").addClass("btn_idol_voice attribute_"+t+"_voice_mark_04")}function s(e,t){$(e).removeClass("btn_idol_voice attribute_"+t+"_voice_mark_04").addClass("btn_idol_voice attribute_"+t+"_voice_mark_02")}function r(){Object.keys(m.idol_story_list).length>0&&(U.set({idol_story_list:m.idol_story_list,idol_detail:m.detail_list[c],ios_app_flg:m.ios_app_flg,apple_review:m.apple_review,paging_info:W.get_paging_info(m.idol_story_list)}),W.render())}function l(e,t){var i={};return Object.keys(x).forEach(function(e){void 0==i[e]&&(i[e]={})}),Object.keys(y).forEach(function(t){var a=y[t];if(void 0!=e[t])if(void 0==i[a.category][a.type]&&(i[a.category][a.type]={}),"???"==e[t]){if(Object.keys(i[a.category][a.type]).length>=1)return;i[a.category][a.type][t]=C[a.conditions]}else i[a.category][a.type][t]=e[t]}),i}var d=window.birthday_flag,c=window.select_card_index,m=window.idol,p=(window.url_trade,window.url_album,window.url_event_memory,window.url_other_event,window.url_cartoon),h=window.url_comment_5th_redirect,u=window.getAudio,g=new Array,f=new Array,w="",v="click",k=window.slider_pos,b=window.select_tab,y=window.comments_info,x=(window.type_names,window.category_names),C=window.conditions_names,j=window.comment_tab_start,S=window.show_premium,M=Backbone.Model.extend({defaults:{}}),O=Backbone.View.extend({el:"#tab-content",template:_.template($("#tab-4-template").html()),initialize:function(){0==m.idol_story_list.length&&(this.template=_.template($("#tab-3-template").html())),this.listenTo(this.model,"change",this.prepare)},events:{},prepare:function(){},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),B=new M,T=new O({model:B}),q=Backbone.Model.extend({defaults:{}}),A={};A[v+" .js_btn_expansion"]="show_expansion_popup",A[v+" .js_btn_change_card_type"]="change_card_type";var E=Backbone.View.extend({el:"#idol-base-content",popup:null,template:_.template($("#idol-base-template").html()),initialize:function(){this.listenTo(this.model,"change",this.prepare)},events:A,change_card_type:function(){switch(m.detail_list[c].show_card_type){case"l_premium":m.detail_list[c].show_card_type="l";break;case"l":default:m.detail_list[c].show_card_type="l_premium"}t(m.detail_list[c].show_card_type)},show_expansion_popup:function(){var e=$("#popup-expansion-template").html(),t=this.model.toJSON();null==this.popup&&(this.popup=new Commonjs.Popup("popup-idol-expansion")),this.popup.set({title:m.detail_list[c].data.card_name,contents:_.template(e,t),full_display_flg:!0}),this.popup.on("close",function(){window.createjs&&Commonjs.Canvas.stop&&Commonjs.Canvas.stop()});var i=this.popup.get_contents(),a=(i.find("#expansion_idol_image"),i.find("#expansion_idol_image_noframe")),n=i.find("#expansion_idol_image_nosign"),o=i.find(".js_replace_premium").eq(0);a.hide(),n.hide(),"l_premium"==m.detail_list[c].show_card_type&&S||+m.detail_list[c].archive.premium&&!+m.detail_list[c].archive.normal&&S?(i.find(".mask01").remove(),Commonjs.replacePremiumCardNew({replace_element:o,card_image:o.attr("src"),width:304,idol_base_id:m.detail_list[c].premium_sign_idol_base_id,script:m.detail_list[c].premium_sign_idol_base_id+"_sign_effect"},0,!0)):m.images.mask_l[c]||m.images.mask_l_p[c]?("l_premium"==m.detail_list[c].show_card_type||!+m.detail_list[c].archive.normal&&+m.detail_list[c].archive.premium?(i.find(".mask01").css("webkitMaskImage","url("+m.images.mask_l_p[c]+")"),i.find(".mask02").css("webkitMaskImage","url("+m.images.mask_l2_p[c]+")"),i.find(".cardFrame01").css("backgroundImage","url("+m.images.mask_l_p[c]+")")):(i.find(".mask01").css("webkitMaskImage","url("+m.images.mask_l[c]+")"),i.find(".mask02").css("webkitMaskImage","url("+m.images.mask_l2[c]+")"),i.find(".cardFrame01").css("backgroundImage","url("+m.images.mask_l[c]+")")),function(){function e(e){var n=e.accelerationIncludingGravity;if(-1!=a.search(/iPhone/))var o=5;else var o=2;(t=Math.floor(n.x*o))>1|t<-1&&(-1!=a.search(/iPhone/)?i.find(".cardFrame02").css("background-position-x",30*-t+"px"):i.find(".cardFrame02").css("background-position-x",80*t+"px"))}var t,a=navigator.userAgent;if(window.addEventListener("devicemotion",e,!0),window.addEventListener("MozOrientation",e,!0),window.localStorage){2==localStorage.getItem("CardEffectSet")&&(i.find(".cardFrame01").hide(),i.find(".cardFrame02").hide())}}()):i.find(".mask01").remove(),a.size()>0&&i.find(".js_card_rotate").on("click",function(e){function t(e){return i.find(".mask011, .mask010, .mask01")}var i=$(e.currentTarget),a=i.find(".js_current");i.css("pointer-events","none"),a.addClass("rotate_disappear"),a.attr("twinkle")&&t().addClass("rotate_disappear"),a.one("webkitAnimationEnd",function(e){var n=a.next();0==n.hasClass("rotate_img")&&(n=i.find(".rotate_img").eq(0)),t().removeClass("rotate_disappear").hide(),n.attr("twinkle")&&t().addClass("rotate_appear").show(),a.removeClass("rotate_disappear js_current").hide(),n.addClass("rotate_appear js_current").show(),n.one("webkitAnimationEnd",function(e){n.removeClass("rotate_appear"),t().removeClass("rotate_appear"),i.css("pointer-events","auto")})})}),this.popup.open()},prepare:function(){},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),F=new q,I=new E({model:F}),V=Backbone.Model.extend({defaults:{}}),z=Backbone.View.extend({el:"#profile-content",template:_.template($("#profile-template").html()),initialize:function(){this.listenTo(this.model,"change",this.prepare)},events:{},prepare:function(){},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),L=new V,N=new z({model:L}),J=Backbone.Model.extend({defaults:{filtered_comments:[]}}),P={};P[v+" .btn_idol_voice"]="voice_play";var G=Backbone.View.extend({el:"#comment-content",template:_.template($("#comment-template").html()),initialize:function(){this.listenTo(this.model,"change",this.prepare)},events:P,voice_play:function(e){var t=m.detail_list[c],i=$(e.currentTarget),a=i.data("voice-key"),n=t.data.hash_card_id,o=a+"_"+n;return""!=w&&w!=o&&g[w].pause(),0==g[o].first?(g[a+"_"+n].autoplay=!1,g[a+"_"+n].src=f[o],g[o].play(),g[o].first=1):g[o].ended?(g[o].src=f[o],g[o].play()):g[o].paused?g[o].play():g[o].paused?(g[o].pause(),g[o].src=f[o]):g[o].pause(),w=o,!1},prepare:function(){},render:function(){this.$el.html(this.template(this.model.toJSON())),Commonjs.setAccordion()}}),D=new J,H=new G({model:D}),K=Backbone.Model.extend({defaults:{}}),Q={};Q[v+" .checkForm"]="set_voice_image",Q[v+" .btn_pager_first"]="pager_first",Q[v+" .btn_pager_back"]="pager_back",Q[v+" .btn_pager_next"]="pager_next",Q[v+" .btn_pager_last"]="pager_last";var R=Backbone.View.extend({el:"#story-content",template:_.template($("#story-template").html()),initialize:function(){this.listenTo(this.model,"change",this.prepare)},events:Q,paging_info:{},set_voice_image:function(e){var t=$(e.currentTarget),i=t.parent(),a=i.find("input[type=hidden]"),n=i.find(".movie_name");if(1==a.val()){a.val("0"),t.removeClass("ep_on").addClass("ep_off");for(var o=0;o<n.length;o++)n.eq(o).attr("src",n.eq(o).attr("src").replace("_voice",""))}else{a.val("1"),t.removeClass("ep_off").addClass("ep_on");for(var o=0;o<n.length;o++)n.eq(o).attr("src",n.eq(o).attr("src").replace(".png","_voice.png"))}},get_paging_info:function(e){return this.paging_info={contents_num:3,current_page:0,max_page_num:Math.floor((Object.keys(e).length-1)/3)},this.paging_info},pager_first:function(e){this.paging_info.current_page=0,this.render()},pager_back:function(e){this.paging_info.current_page=Math.max(--this.paging_info.current_page,0),this.render()},pager_next:function(e){this.paging_info.current_page=Math.min(++this.paging_info.current_page,this.paging_info.max_page_num),this.render()},pager_last:function(e){this.paging_info.current_page=this.paging_info.max_page_num,this.render()},prepare:function(){},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),U=new K,W=new R({model:U}),X=Backbone.Model.extend({defaults:{}}),Y=Backbone.View.extend({el:"#parameter-content",template:_.template($("#parameter-template").html()),initialize:function(){this.listenTo(this.model,"change",this.prepare)},events:{},prepare:function(){},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),Z=new X,ee=new Y({model:Z});$(window).on("load",function(){B.set(),T.render(),$("#contents_tab").tab_switch({tabs:"[name^='tab_']",contents:"[class^='area_tab_']",start:b}),t(),i(),a(),n(),r(),null!=j&&$("#comment-content").find(".selectArea_accordion_title").eq(j).trigger(v,!1),Object.keys(m.idol_story_list).length>0&&(U.set({idol_story_list:m.idol_story_list,idol_detail:m.detail_list[c],ios_app_flg:m.ios_app_flg,apple_review:m.apple_review}),W.render()),Z.set(m.detail_list[c]),ee.render(),e(),$(".idolList").iSlider({height:"160px",slideshowSpeed:0,navi:".icon_navi",selected:"icon_selected",touch:!0,start:k,loop:!1}),$(".idol").on("click",function(o){c=$(o.currentTarget).data("index"),m.detail_list[c].show_card_type="l",t(),i(),a(),n(),r(),Z.set(m.detail_list[c]),ee.render(),e()})});var te=te||{check:{hasLocalStorage:function(){return!!window.localStorage},isVoicePlay:function(){return!(!this.hasLocalStorage()||"OFF"==Commonjs.loadLocalStorage("IdolVoiceAdmitSwitch"))}}};$(".js_submit_check_idol_comment_3rd").on("click",function(){$(".form_check_idol_comment_3rd").submit()}),$(".js_submit_check_idol_comment_5th").on("click",function(){$(".form_check_idol_comment_5th").submit()})});